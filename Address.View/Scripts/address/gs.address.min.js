var GLOBE=new function(){this.MAP_LARGE=undefined;this.MAP_CONTROL_DOM={AddPolygonDiv:undefined,EditPolygonDiv:undefined,AddLocationBtn:undefined};this.ADD_MODE=false;this.EDIT_MODE=false;this.HISTORY_MODE=false},ADDRESS=new function(){this.MARKER_CURRENT=undefined;this.POLY_CURRENT=undefined;this.POLYLINE_CURRENT=undefined;this.EVENT_CURRENT={poly_current:undefined,marker_current:undefined};this.PATHS={"1":undefined,"2":undefined,"4":undefined,"8":undefined,"16":undefined};this.POINTS={"1":undefined,"2":undefined,"4":undefined,"8":undefined,"16":undefined};this.IDS={"1":undefined,"2":undefined,"4":undefined,"8":undefined,"16":undefined};this.PARENTIDS={"1":undefined,"2":undefined,"4":undefined,"8":undefined,"16":undefined};this.LEVEL_CURRENT=undefined;this.MARKER_DRAFT=undefined;this.POLY_DRAFT=undefined;this.POLYLINE_DRAFT=undefined},ADDRESS_OBJECT=new function(){this.A_ID=undefined;this.A_NAME=undefined;this.A_DESCRIPTION=undefined;this.A_LEVEL=undefined;this.A_PARENT=undefined;this.A_CENTER=undefined;this.A_BORDER=undefined;this.DESTROY=function(){this.A_NAME="";this.A_DESCRIPTION="";this.A_LEVEL=undefined;this.A_PARENT=undefined;this.A_CENTER=undefined;this.A_BORDER=undefined}};function toggleTwoDivs(a,b){$(a).toggle(true);$(b).toggle(false)}function toLatLng(c){var a=c.split(" "),b=new google.maps.LatLng(a[1],a[0]);return b}function toMVCArray(c,b){if(b==undefined)b=true;var a=new google.maps.MVCArray;$.each(c,function(c,b){b!=""&&a.insertAt(a.length,toLatLng(b))});!b&&a.removeAt(a.length-1);return a}function toMVCArrayFromString(e,d){if(d==undefined)d=true;for(var c=new google.maps.MVCArray,b=e.split(","),f="",a=0;a<b.length;a=a+2)if(b[a]!=""){f=b[a+1]+" "+b[a];c.insertAt(c.length,new google.maps.LatLng(b[a],b[a+1]))}!d&&c.removeAt(c.length-1);return c}function showPointsInPoly(){$("#poly_dialog").dialog("option","title","d\u1eef li\u1ec7u \u0111\u01b0\u1eddng n\u00e9t");$("#poly_dialog").dialog("open")}function drawPolyFromPoints(){if(GLOBE.ADD_MODE){ADDRESS.POLY_DRAFT.stopEdit();ADDRESS.POLY_DRAFT.setPath(toMVCArrayFromString($("#extracted_data").val(),false));$(".map_canvas").gsMap("setEditablePoly",ADDRESS.POLY_DRAFT,true);$(".map_canvas").gsMap("fitBounds",ADDRESS.POLY_DRAFT);$("#poly_dialog").dialog("close")}else if(GLOBE.EDIT_MODE){ADDRESS.POLY_CURRENT.stopEdit();ADDRESS.POLY_CURRENT.setPath(toMVCArrayFromString($("#extracted_data").val(),false));$(".map_canvas").gsMap("setEditablePoly",ADDRESS.POLY_CURRENT,true);$(".map_canvas").gsMap("fitBounds",ADDRESS.POLY_CURRENT);$("#poly_dialog").dialog("close")}}function toDataForBindSelectTag(b){var a='<option value="">Ch\u1ecdn \u0111\u1ecba danh</option>';$.each(b,function(c,b){if(b!="")a=a+'<option value="'+b.A_ID+'" >'+b.A_Name+"</option>"});return a}function toLevel(a){switch(a){case"1":return 0;case"2":return 1;case"4":return 2;case"8":return 3;case"16":return 4}}function toSelecor(a){switch(a){case 1:return"#national_select";case 2:return"#province_select";case 4:return"#district_select";case 8:return"#block_select";case 16:return"#road_select"}}function showAddress(b){if(GLOBE.EDIT_MODE||GLOBE.ADD_MODE)alert("B\u1ea1n h\u00e3y ho\u00e0n th\u00e0nh c\u00e1c thao t\u00e1c tr\u01b0\u1edbc khi ti\u1ebfp t\u1ee5c!");else{ADDRESS.LEVEL_CURRENT=b;var a=b.toString();if(ADDRESS.POLYLINE_CURRENT!=undefined){ADDRESS.POLYLINE_CURRENT.setMap(null);ADDRESS.POLYLINE_CURRENT=undefined}ADDRESS.POLY_CURRENT!=undefined&&ADDRESS.POLY_CURRENT.setMap(null);if(b!=16)ADDRESS.POLY_CURRENT=$(".map_canvas").gsMap("addPolygon",{path:toMVCArray(ADDRESS.PATHS[a],false)});else ADDRESS.POLY_CURRENT=$(".map_canvas").gsMap("addPolyline",{strokeWeight:8.5,path:toMVCArray(ADDRESS.PATHS[a])});$(".map_canvas").gsMap("fitBounds",ADDRESS.POLY_CURRENT);google.maps.event.clearListeners(ADDRESS.POLY_CURRENT,"click");ADDRESS.EVENT_CURRENT.poly_current=$(".map_canvas").gsMap("addEvent",ADDRESS.POLY_CURRENT,"click",polyClickHandler);ADDRESS.MARKER_CURRENT!=undefined&&ADDRESS.MARKER_CURRENT.setMap(null);ADDRESS.MARKER_CURRENT=$(".map_canvas").gsMap("addMarker",{draggable:false,raiseOnDrag:true,position:toLatLng(ADDRESS.POINTS[a])})}}function getAddress(b,c){var a=$(b).val(),d=$(b+" option:selected").text();a!=""&&a!=undefined&&$.ajax({type:"POST",url:"/address/getaddress",data:{id:a},dataType:"json",success:function(a){var b=a.A_Level.toString();ADDRESS.IDS[b]=a.A_ID;ADDRESS.PARENTIDS[b]=a.A_ParentID;ADDRESS.POINTS[b]=a.A_Center;ADDRESS.PATHS[b]=a.Points;var d=toLevel(b);$("#location_current  span").filter(function(a){return a>=d}).remove();$(".select_address_container  select").filter(function(a){return a>d+1}).empty();var e='<span> > <a href="javascript:void(0)" onclick="showAddress('+a.A_Level+');">'+a.A_Name+"</a> </span>";$("#location_current").append(e);showAddress(a.A_Level);$(toSelecor(ADDRESS.LEVEL_CURRENT)+" option:selected").text(a.A_Name);$(c).html(toDataForBindSelectTag(a.A_Children))},error:function(b,c,a){alert(b.status+":"+a)}})}function _dowhat(){$(".page").css("height",$(window).height()-1+"px");var a=$(".page").height()-$(".page-banner").height()-$(".page-footer").height();$(".page-content").css("height",a+"px");$(".layout_panel").slidePanel("setHeight",a);return a}$(document).ready(function(){var b=_dowhat(),a=null;$(window).bind("resize",function(){a&&clearTimeout(a);a=setTimeout(_dowhat,100)});$(".layout_panel").slidePanel({autoHide:false,height:b,widthToShow:350,widthToHide:25,titleToHide:"<b>C\u00e1c c\u1ea5p h\u00e0nh ch\u00ednh</b>"});GLOBE.MAP_LARGE=$(".map_canvas").gsMap({mapProvider:"google",mapGoogleOptions:{zoom:16,mapTypeId:google.maps.MapTypeId.SATELLITE,panControl:false,scaleControl:false,streetViewControl:false}});$(".map_canvas").gsMap("addSearchBox",google.maps.ControlPosition.TOP_LEFT);GLOBE.MAP_CONTROL_DOM.AddPolygonDiv=$(".map_canvas").gsMap("addControl",google.maps.ControlPosition.TOP_CENTER,'<div><span class="showinfo">\u0111\u01b0\u1eddng n\u00e9t ngo\u00e0i</span><input type="button" title="th\u00eam \u0111\u01b0\u1eddng n\u00e9t ngo\u00e0i"  class="button" value="th\u00eam" onclick="addPoly();" /><input type="button" title="ki\u1ec3m tra t\u1ed3n t\u1ea1i \u0111\u1ecba danh t\u1ea1i v\u1ecb tr\u00ed \u0111\u00e1nh d\u1ea5u"  class="button" value="ki\u1ec3m tra" onclick="checkExists();" /><input  class="button savePoly" onclick="savePoly();" type="button" value="l\u01b0u l\u1ea1i" /><input  class="button cancerPoly" onclick="cancerPoly();" type="button" value="h\u1ee7y" /></div>',{background:"none repeat scroll 0 0 #000",opacity:0,display:"none",color:"#F51A1A","font-size":"14px","font-weight":"bold"});GLOBE.MAP_CONTROL_DOM.EditPolygonDiv=$(".map_canvas").gsMap("addControl",google.maps.ControlPosition.TOP_CENTER,'<div><input type="button" class="button" value="v\u1ebd m\u1edbi" onclick="newPoly();" /><input type="button" class="button" value="kh\u00f4i ph\u1ee5c" onclick="refreshPoly();" /><input  class="button savePoly" onclick="updatePoly();" type="button" value="l\u01b0u l\u1ea1i" /><input  class="button cancerPoly" onclick="exitEditPoly();" type="button" value="h\u1ee7y" /></div>',{background:"none repeat scroll 0 0 #000",opacity:0,display:"none",color:"#F51A1A","font-size":"14px","font-weight":"bold"});GLOBE.MAP_CONTROL_DOM.AddLocationBtn=$(".map_canvas").gsMap("addControl",google.maps.ControlPosition.LEFT_TOP,'<input class="button addMarker" type="button" value="Th\u00eam \u0111\u1ecba danh" onclick="authorize(addAddress);" />');$(".map_canvas").bind("resize",function(){google.maps.event.trigger(GLOBE.MAP_LARGE,"resize")});getAddress("#national_select","#province_select");$(".div_inline_block").gsWaiting();$(".history_container").gsScrollPagination({url:"/address/gethistories",currentPage:1,totalResults:15000,perPage:15,pagerVar:"p",container:".history_content",outerHeightItemInPage:40,range:10});$(".history_container").toggle(false);$(".newest_container").gsScrollPagination({url:"/address/newest",currentPage:1,totalResults:1e3,perPage:15,pagerVar:"p",container:".newest_content",outerHeightItemInPage:40,range:10});$(".select_address_container select").removeAttr("disabled")});function authorize(a){$.ajax({type:"POST",url:"/address/authorize",cache:false,dataType:"Json",success:function(b){if(b.isAuthorize)var c=new a;else alert("B\u1ea1n c\u1ea7n \u0111\u0103ng nh\u1eadp \u0111\u1ec3 s\u1eed d\u1ee5ng ch\u1ee9c n\u0103ng n\u00e0y!")},error:function(b,c,a){alert(b.status+":"+a)}})}function showOnlyBorder(a){ADDRESS.MARKER_CURRENT!=undefined&&ADDRESS.MARKER_CURRENT.setMap(null);ADDRESS.POLY_CURRENT!=undefined&&ADDRESS.POLY_CURRENT.setMap(null);ADDRESS.POLYLINE_CURRENT!=undefined&&ADDRESS.POLYLINE_CURRENT.setMap(null);ADDRESS.POLYLINE_CURRENT=$(".map_canvas").gsMap("addPolyline",{path:toMVCArray(ADDRESS.PATHS[a]),strokeColor:"#0000FF"});$(".map_canvas").gsMap("fitBounds",ADDRESS.POLYLINE_CURRENT);GLOBE.MAP_LARGE.setZoom(GLOBE.MAP_LARGE.getZoom()+1)}var addAddress=function(){$(".select_address_container select").attr("disabled",true);$(".map_canvas").gsMap("removeDraftLines");!GLOBE.ADD_MODE&&showOnlyBorder(ADDRESS.LEVEL_CURRENT.toString());GLOBE.ADD_MODE=true;if(ADDRESS.MARKER_DRAFT){ADDRESS.MARKER_DRAFT.setMap(null);ADDRESS.MARKER_DRAFT=undefined}ADDRESS.MARKER_DRAFT=$(".map_canvas").gsMap("addMarker");$(GLOBE.MAP_CONTROL_DOM.AddPolygonDiv).css({display:"block"});$(GLOBE.MAP_CONTROL_DOM.AddPolygonDiv).animate({opacity:.7},200);if(ADDRESS.POLY_DRAFT){ADDRESS.POLY_DRAFT.setMap(null);ADDRESS.POLY_DRAFT.stopEdit();ADDRESS.POLY_DRAFT=undefined}};function checkExists(){ADDRESS_OBJECT.A_PARENT=ADDRESS.IDS[ADDRESS.LEVEL_CURRENT.toString()];if(ADDRESS.LEVEL_CURRENT<16)ADDRESS_OBJECT.A_LEVEL=ADDRESS.LEVEL_CURRENT*2;else ADDRESS_OBJECT.A_LEVEL=ADDRESS.LEVEL_CURRENT;ADDRESS_OBJECT.A_CENTER=ADDRESS.MARKER_DRAFT.toGeoString();$.ajax({type:"POST",url:"/address/exists",cache:false,data:{level:ADDRESS_OBJECT.A_LEVEL,pid:ADDRESS_OBJECT.A_PARENT,center:ADDRESS_OBJECT.A_CENTER},dataType:"json",success:function(b){if(b.length>0){var a="";$.each(b,function(c,b){a=a+b.A_Name+" "});alert("\u0110\u1ecba danh "+a+"\u0111\u00e3 c\u00f3 t\u1ea1i v\u1ecb tr\u00ed \u0111\u00e1nh d\u1ea5u!")}else alert("T\u1ea1i v\u1ecb tr\u00ed \u0111\u00e1nh d\u1ea5u ch\u01b0a c\u00f3 \u0111\u1ecba danh n\u00e0o!")},error:function(b,c,a){alert(b.status+":"+a)},complete:function(){$("#addBtn").removeAttr("disabled")}})}function addPoly(){if(ADDRESS.POLY_DRAFT){ADDRESS.POLY_DRAFT.setMap(null);ADDRESS.POLY_DRAFT.stopEdit();ADDRESS.POLY_DRAFT=undefined}if(ADDRESS.LEVEL_CURRENT<8){ADDRESS.POLY_DRAFT=$(".map_canvas").gsMap("createPolygon");$(".map_canvas").gsMap("addEvent",ADDRESS.POLY_DRAFT,"rightclick",showPointsInPoly)}else ADDRESS.POLY_DRAFT=$(".map_canvas").gsMap("createPolyline")}function cancerPoly(a){if(a==undefined)a=true;GLOBE.ADD_MODE=false;if(ADDRESS.MARKER_DRAFT){ADDRESS.MARKER_DRAFT.setMap(null);ADDRESS.MARKER_DRAFT=undefined}if(ADDRESS.POLY_DRAFT){ADDRESS.POLY_DRAFT.stopEdit();ADDRESS.POLY_DRAFT.setMap(null);ADDRESS.POLY_DRAFT=undefined}$(".map_canvas").gsMap("removeDraftLines");$(GLOBE.MAP_CONTROL_DOM.AddPolygonDiv).animate({opacity:0},200,function(){$(GLOBE.MAP_CONTROL_DOM.AddPolygonDiv).css({display:"none"})});if(a){showAddress(ADDRESS.LEVEL_CURRENT);$("#address_dialog").dialog("close")}$(".select_address_container select").removeAttr("disabled")}function savePoly(){if(ADDRESS.POLY_DRAFT!=undefined&&ADDRESS.POLY_DRAFT.toGeoString(true)!="")$.ajax({type:"GET",url:"/address/add",data:{},dataType:"html",success:function(a){$("#address_dialog").html(a);$("#A_Name").val(ADDRESS_OBJECT.A_NAME);$("#A_Description").val(ADDRESS_OBJECT.A_DESCRIPTION);$("#address_dialog").dialog("option","title","th\u00eam \u0111\u1ecba danh");$("#address_dialog").dialog("open")},error:function(b,c,a){alert(b.status+":"+a)}});else alert("\u0110\u01b0\u1eddng n\u00e9t ch\u01b0a ho\u00e0n th\u00e0nh!")}function saveAddress(){var a=true;a=a&&checkLength($("#A_Name"),"t\u00ean \u0111\u1ecba danh",1,1e3);if(a){$("#addBtn").attr("disabled",true);ADDRESS_OBJECT.A_NAME=$("#A_Name").val();ADDRESS_OBJECT.A_PARENT=ADDRESS.IDS[ADDRESS.LEVEL_CURRENT.toString()];ADDRESS_OBJECT.A_DESCRIPTION=$("#A_Description").val();if(ADDRESS.LEVEL_CURRENT<16)ADDRESS_OBJECT.A_LEVEL=ADDRESS.LEVEL_CURRENT*2;else ADDRESS_OBJECT.A_LEVEL=ADDRESS.LEVEL_CURRENT;ADDRESS_OBJECT.A_CENTER=ADDRESS.MARKER_DRAFT.toGeoString();ADDRESS_OBJECT.A_BORDER=ADDRESS.POLY_DRAFT.toGeoString(true);$.ajax({type:"POST",url:"/address/add",cache:false,data:{aname:ADDRESS_OBJECT.A_NAME,adesc:ADDRESS_OBJECT.A_DESCRIPTION,alevel:ADDRESS_OBJECT.A_LEVEL,aparent:ADDRESS_OBJECT.A_PARENT,acenter:ADDRESS_OBJECT.A_CENTER,aborder:ADDRESS_OBJECT.A_BORDER},dataType:"html",success:function(a){$("#address_dialog").find("div.add_address_result").remove();$("#address_dialog").append(a);if($("#address_dialog").find("div.add_address_success").length>0){$("#address_dialog").find("div.add_address_container").remove();cancerPoly(false);ADDRESS_OBJECT.DESTROY();if(ADDRESS.LEVEL_CURRENT<16)getAddress(toSelecor(ADDRESS.LEVEL_CURRENT),toSelecor(ADDRESS.LEVEL_CURRENT*2));else getAddress(toSelecor(ADDRESS.LEVEL_CURRENT/2),toSelecor(ADDRESS.LEVEL_CURRENT))}},error:function(b,c,a){alert(b.status+":"+a)},complete:function(){$("#addBtn").removeAttr("disabled")}})}}var polyClickHandler=function(){$("#address_dialog").dialog("option","title","chi ti\u1ebft \u0111\u1ecba danh");$("#address_dialog").empty();$("#address_dialog").dialog("open");$.ajax({type:"GET",url:"/address/detail",cache:false,data:{id:ADDRESS.IDS[ADDRESS.LEVEL_CURRENT.toString()]},dataType:"html",success:function(a){$("#address_dialog").html(a)},complete:function(){},error:function(b,c,a){alert(b.status+":"+a)}})},editAddress=function(){$("#address_dialog").find("div.history_detail_container").css({display:"none"});closeDialog();GLOBE.EDIT_MODE=true;$(".select_address_container select").attr("disabled",true);$(GLOBE.MAP_CONTROL_DOM.AddLocationBtn).css({display:"none"});$(GLOBE.MAP_CONTROL_DOM.EditPolygonDiv).css({display:"block"});$(GLOBE.MAP_CONTROL_DOM.EditPolygonDiv).animate({opacity:.7},200);if(ADDRESS.LEVEL_CURRENT>1){if(ADDRESS.POLYLINE_CURRENT!=undefined){ADDRESS.POLYLINE_CURRENT.setMap(null);ADDRESS.POLYLINE_CURRENT=undefined}ADDRESS.POLYLINE_CURRENT=$(".map_canvas").gsMap("addPolyline",{path:toMVCArray(ADDRESS.PATHS[(ADDRESS.LEVEL_CURRENT/2).toString()]),strokeColor:"#0713FB",strokeOpacity:1})}$(".map_canvas").gsMap("setEditablePoly",ADDRESS.POLY_CURRENT,true);$(".map_canvas").gsMap("addEvent",ADDRESS.POLY_CURRENT,"rightclick",showPointsInPoly);google.maps.event.clearListeners(ADDRESS.POLY_CURRENT,"click");ADDRESS.MARKER_CURRENT.setDraggable(true)};function newPoly(){if(ADDRESS.POLY_CURRENT){ADDRESS.POLY_CURRENT.setMap(null);ADDRESS.POLY_CURRENT.stopEdit();ADDRESS.POLY_CURRENT=undefined}if(ADDRESS.LEVEL_CURRENT<16)ADDRESS.POLY_CURRENT=$(".map_canvas").gsMap("createPolygon");else ADDRESS.POLY_CURRENT=$(".map_canvas").gsMap("createPolyline")}function refreshPoly(){$(".map_canvas").gsMap("removeDraftLines");if(ADDRESS.POLY_CURRENT){ADDRESS.POLY_CURRENT.stopEdit();ADDRESS.POLY_CURRENT.setPath(toMVCArray(ADDRESS.PATHS[ADDRESS.LEVEL_CURRENT.toString()],false));$(".map_canvas").gsMap("setEditablePoly",ADDRESS.POLY_CURRENT,true);ADDRESS.MARKER_CURRENT.setPosition(toLatLng(ADDRESS.POINTS[ADDRESS.LEVEL_CURRENT.toString()]))}}function updatePoly(){if(ADDRESS.POLY_CURRENT!=undefined&&ADDRESS.POLY_CURRENT.toGeoString(true)!=""){$("#address_dialog").find("div.add_address_result").remove();$("#address_dialog").dialog("option","title","s\u1eeda \u0111\u1ecba danh");$("#address_dialog").find("div.detail_address_form").css({display:"none"});$("#address_dialog").find("div.edit_address_form").css({display:"block"});$("#address_dialog").dialog("open")}else alert("\u0110\u01b0\u1eddng n\u00e9t ch\u01b0a ho\u00e0n th\u00e0nh!")}var editInfoAddress=function(){$("#address_dialog").dialog("option","title","s\u1eeda \u0111\u1ecba danh");$("#address_dialog").find("div.detail_address_form").css({display:"none"});$("#address_dialog").find("div.history_detail_container").css({display:"none"});$("#address_dialog").find("div.edit_address_form").css({display:"block"})};function exitEditPoly(a){if(a==undefined)a=true;GLOBE.EDIT_MODE=false;$(".map_canvas").gsMap("setEditablePoly",ADDRESS.POLY_CURRENT,false);ADDRESS.MARKER_CURRENT.setDraggable(false);$(".map_canvas").gsMap("removeDraftLines");$(GLOBE.MAP_CONTROL_DOM.AddLocationBtn).css({display:"block"});$(GLOBE.MAP_CONTROL_DOM.EditPolygonDiv).animate({opacity:0},200,function(){$(GLOBE.MAP_CONTROL_DOM.EditPolygonDiv).css({display:"none"})});if(a){showAddress(ADDRESS.LEVEL_CURRENT);ADDRESS.EVENT_CURRENT.poly_current=$(".map_canvas").gsMap("addEvent",ADDRESS.POLY_CURRENT,"click",polyClickHandler);$("#address_dialog").dialog("close")}if(ADDRESS.POLYLINE_CURRENT!=undefined){ADDRESS.POLYLINE_CURRENT.setMap(null);ADDRESS.POLYLINE_CURRENT=undefined}$(".select_address_container select").removeAttr("disabled")}function updateAddress(){var a=true;a=a&&checkLength($("#A_Name"),"t\u00ean \u0111\u1ecba danh",1,1e3);if(a){$("#updateBtn").attr("disabled",true);ADDRESS_OBJECT.A_ID=ADDRESS.IDS[ADDRESS.LEVEL_CURRENT.toString()];ADDRESS_OBJECT.A_NAME=$("#A_Name").val();ADDRESS_OBJECT.A_DESCRIPTION=$("#A_Description").val();ADDRESS_OBJECT.A_LEVEL=ADDRESS.LEVEL_CURRENT;ADDRESS_OBJECT.A_PARENT=ADDRESS.PARENTIDS[ADDRESS.LEVEL_CURRENT.toString()];ADDRESS_OBJECT.A_CENTER=ADDRESS.MARKER_CURRENT.toGeoString();ADDRESS_OBJECT.A_BORDER=ADDRESS.POLY_CURRENT.toGeoString(true);$.ajax({type:"POST",url:"/address/update",cache:false,data:{aid:ADDRESS_OBJECT.A_ID,aname:ADDRESS_OBJECT.A_NAME,adesc:ADDRESS_OBJECT.A_DESCRIPTION,alevel:ADDRESS_OBJECT.A_LEVEL,aparent:ADDRESS_OBJECT.A_PARENT,acenter:ADDRESS_OBJECT.A_CENTER,aborder:ADDRESS_OBJECT.A_BORDER},dataType:"html",success:function(a){$("#address_dialog").find("div.add_address_result").remove();$("#address_dialog").find("div.detail_address_container").after(a);if($("#address_dialog").find("div.add_address_success").length>0){$("#address_dialog").find("div.detail_address_container").remove();$("#address_dialog").find("div.history_detail_container").remove();exitEditPoly(false);getAddress(toSelecor(ADDRESS.LEVEL_CURRENT),toSelecor(ADDRESS.LEVEL_CURRENT*2));ADDRESS_OBJECT.DESTROY()}},complete:function(){$("#updateBtn").removeAttr("disabled")},error:function(b,c,a){alert(b.status+":"+a)}})}}var beginDelAddress=function(){$("#address_dialog").dialog("option","title","x\u00f3a \u0111\u1ecba danh");$("#address_dialog").find("div.detail_address_form").css({display:"none"});$("#address_dialog").find("div.delete_address_form").css({display:"block"})};function backToDetail(){$("#address_dialog").dialog("option","title","chi ti\u1ebft \u0111\u1ecba danh");$("#address_dialog").find("div.delete_address_form").css({display:"none"});$("#address_dialog").find("div.edit_address_form").css({display:"none"});$("#address_dialog").find("div.detail_address_form").css({display:"block"});$("#address_dialog").find("div.history_detail_container").css({display:"block"})}function deleteAddress(){var a=true;a=a&&checkLength($("#reasons"),"l\u00fd do x\u00f3a \u0111\u1ecba danh",5,1e3);if(a&&confirm("B\u1ea1n ch\u1eafc ch\u1eafn mu\u1ed1n x\u00f3a \u0111\u1ecba danh n\u00e0y!")){$("#deleteBtn").attr("disabled",true);ADDRESS_OBJECT.A_ID=ADDRESS.IDS[ADDRESS.LEVEL_CURRENT.toString()];$.ajax({type:"POST",url:"/address/delete",cache:false,data:{aid:ADDRESS_OBJECT.A_ID,reasons:$("#reasons").val()},dataType:"json",success:function(a){if(a.success){$("#address_dialog").html('<div style="text-align:center;"><h4>c\u1eadp nh\u1eadt \u0111\u1ecba danh th\u00e0nh c\u00f4ng</h4></div><div style="text-align: right;"><input type="button" onclick="closeDialog();" value="\u0111\u00f3ng" /></div>');if(a.urole>2)if(ADDRESS.LEVEL_CURRENT>1)getAddress(toSelecor(ADDRESS.LEVEL_CURRENT/2),toSelecor(ADDRESS.LEVEL_CURRENT));else{ADDRESS.POLY_CURRENT.setMap(null);ADDRESS.MARKER_CURRENT.setMap(null);$(".select_address_container  select").filter(function(a){return a>0}).empty()}}else $("#address_dialog").find("div.delete_address_form").append('div style="text-align:center; color: Red;">c\u1eadp nh\u1eadt \u0111\u1ecba danh kh\u00f4ng th\u00e0nh c\u00f4ng</div>')},error:function(b,c,a){alert(b.status+":"+a)},complete:function(){$("#deleteBtn").removeAttr("disabled")}})}}function getDetailHistory(a){GLOBE.HISTORY_MODE=true;$("div.history_address_container").find(".history_address_row").removeClass("history_row_selected");$("div.history_address_container").find("."+a).addClass("history_row_selected");$.ajax({type:"POST",url:"/address/historydetail",cache:false,data:{id:a},dataType:"json",success:function(a){$(".detail_address_form").find("span#display_name").text(a.H_Name);$(".detail_address_form").find("textarea#display_desc").text(a.H_Description);$(".edit_address_form").find("input#A_Name").val(a.H_Name);$(".edit_address_form").find("textarea#A_Description").text(a.H_Description);if(a.H_Level!=16)ADDRESS.POLY_CURRENT.setPath(toMVCArray(a.Points,false));else ADDRESS.POLY_CURRENT.setPath(toMVCArray(a.Points,true));ADDRESS.POLY_CURRENT.setOptions({strokeColor:"#0000FF"});ADDRESS.MARKER_CURRENT.setPosition(toLatLng(a.H_Center));$(".map_canvas").gsMap("fitBounds",ADDRESS.POLY_CURRENT);$("#address_dialog").scrollTop(0)},error:function(b,c,a){alert(b.status+":"+a)}})}function toggleHistoryView(a){if(!a){$("#address_dialog").dialog("option","title","l\u1ecbch s\u1eed c\u1eadp nh\u1eadt");$("#address_dialog").dialog("option","position",["left","top"]);$("#address_dialog").dialog("option","width",200);$("#address_dialog").dialog("option","height",220);$("#address_dialog").find("div.detail_address_container").hide();$("#address_dialog").find("div.history_detail_container").hide();$("#address_dialog").find("div.history_summary_container").show()}else{$("#address_dialog").dialog("option","title","chi ti\u1ebft \u0111\u1ecba danh");$("#address_dialog").dialog("option","position",[150,80]);$("#address_dialog").dialog("option","width",740);$("#address_dialog").dialog("option","height",470);$("#address_dialog").find("div.detail_address_container").show();$("#address_dialog").find("div.history_detail_container").show();$("#address_dialog").find("div.history_summary_container").hide()}}function historyClick(a,b){if(GLOBE.EDIT_MODE||GLOBE.ADD_MODE)alert("B\u1ea1n h\u00e3y ho\u00e0n th\u00e0nh c\u00e1c thao t\u00e1c tr\u01b0\u1edbc khi ti\u1ebfp t\u1ee5c!");else{$(".div_inline_block").has($(a)).gsWaiting("show");$.ajax({type:"POST",url:"/address/historydetail",cache:false,data:{id:b},dataType:"json",success:function(b){var a="";a+='<div class="detail_address_container"><div class="detail_address_form">';a+="<div><label>t\u00ean \u0111\u1ecba danh</label></div>";a+='<div><span class="text" id="display_name">'+b.H_Name+"</span></div>";a+="<div><label>mi\u00eau t\u1ea3 \u0111\u1ecba danh</label></div>";a+='<div><textarea rows="16" cols="10" name="A_Description" readonly="readonly" id="display_desc"  >'+b.H_Description+"</textarea></div>";a+='<div style="text-align: left;">';a+="<div><b>"+b.H_Action+" - "+b.H_ActionDetail+"</b></div>";a+="<div><b>t\u1ea1o b\u1edfi "+b.H_CreatedByUser+"</b></div>";a+="</div>";a+='<div style="text-align: right;">';a+='<input type="button"  onclick="closeDialog();" value="\u0111\u00f3ng" />';a+="</div>";a+="</div></div>";$("#address_dialog").dialog("option","title","chi ti\u1ebft l\u1ecbch s\u1eed");$("#address_dialog").html(a);if(ADDRESS.POLY_CURRENT){ADDRESS.POLY_CURRENT.setMap(null);ADDRESS.MARKER_CURRENT.setMap(null)}if(b.H_Level!=16)ADDRESS.POLY_CURRENT=$(".map_canvas").gsMap("addPolygon",{path:toMVCArray(b.Points,false),strokeColor:"#0000FF"});else ADDRESS.POLY_CURRENT=$(".map_canvas").gsMap("addPolyline",{path:toMVCArray(b.Points),strokeWeight:8.5});ADDRESS.MARKER_CURRENT=$(".map_canvas").gsMap("addMarker",{position:toLatLng(b.H_Center)});$(".map_canvas").gsMap("fitBounds",ADDRESS.POLY_CURRENT);google.maps.event.clearListeners(ADDRESS.POLY_CURRENT,"click");ADDRESS.EVENT_CURRENT.poly_current=$(".map_canvas").gsMap("addEvent",ADDRESS.POLY_CURRENT,"click",function(){$("#address_dialog").dialog("open")})},complete:function(){$(".div_inline_block").has($(a)).gsWaiting("hide")},error:function(b,c,a){alert(b.status+":"+a)}})}}function restoreHistory(a){$.ajax({type:"POST",url:"/address/restore",cache:false,data:{hid:a},dataType:"json",success:function(b){if(b.success){var a="";a+='<div class="detail_address_container">';a+='<div style="text-align: left;">';a+="<span><b>\u00e1p d\u1ee5ng l\u1ecbch s\u1eed th\u00e0nh c\u00f4ng</b></span>";a+="</div>";a+='<div style="text-align: right;">';a+='<input type="button"  onclick="closeDialog();" value="\u0111\u00f3ng" />';a+="</div>";a+="</div>";$("#address_dialog").dialog("option","title","l\u1ecbch s\u1eed");$("#address_dialog").html(a);getAddress(toSelecor(ADDRESS.LEVEL_CURRENT),toSelecor(ADDRESS.LEVEL_CURRENT*2))}else alert("\u00e1p d\u1ee5ng l\u1ecbch s\u1eed kh\u00f4ng th\u00e0nh c\u00f4ng")},complete:function(){},error:function(b,c,a){alert(b.status+":"+a)}})}